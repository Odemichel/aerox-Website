---
import Layout from "~/layouts/Layout.astro";

// src/pages/abonnement.astro
---

<Layout metadata={{
  title: "Devenir Pionnier AeroX",
  description: "Fais partie des 100 premiers pionniers AeroX : transforme ton home trainer en soufflerie virtuelle et gagne jusquâ€™Ã  3 km/h gratuitement. Paiement sÃ©curisÃ©, avantages exclusifs Ã  vie."
}}>
  <section class="max-w-3xl mx-auto py-16 text-center">
    <!-- HERO -->
    <h1 class="text-3xl md:text-4xl font-bold mb-6">
      ğŸš€ Deviens Pionnier AeroX
    </h1>
    <p class="text-lg text-muted mb-8">
      Lâ€™aÃ©rodynamisme, jusquâ€™ici rÃ©servÃ© aux pros, enfin accessible avec une simple webcam.<br/>
      Rejoins les <strong>100 premiers utilisateurs</strong> et transforme ton home trainer en soufflerie virtuelle.
    </p>
    <button
      id="btn-checkout"
      type="button"
      class="btn btn-primary px-8 py-3"
      aria-label="Devenir pionnier AeroX et accÃ©der Ã  l'offre exclusive"
    >
      Je deviens pionnier maintenant
    </button>
    <small class="block mt-2 text-xs text-muted">
      Paiement unique â€” Offre limitÃ©e aux 100 premiers
    </small>

    <!-- SECTION 1 : Le problÃ¨me -->
    <div class="mt-20 text-left">
      <h2 class="text-2xl font-semibold mb-4">ğŸš´ Pourquoi AeroX change tout</h2>
      <p class="text-muted mb-6">
        Tu roules fort mais tu te fais dÃ©poser sur le plat ?  
        Ton vÃ©lo Ã  10 000 â‚¬ ne compense pas une position mal optimisÃ©e.  
        <strong>Ã€ 25 km/h, lâ€™aÃ©rodynamisme reprÃ©sente 70% de ce qui te freine.</strong>  
        Et pourtant, aucun logiciel dâ€™entraÃ®nement classique (Zwift, MyWhoosh, Kinomap) ne te donne ce feedback.
      </p>
    </div>

    <!-- SECTION 2 : Les bÃ©nÃ©fices -->
    <div class="mt-16 text-left">
      <h2 class="text-2xl font-semibold mb-4">âœ¨ Tes avantages de pionnier</h2>
      <ul class="space-y-3 text-muted">
        <li>âœ… <strong>AccÃ¨s complet</strong> Ã  AeroX pendant 4 mois</li>
        <li>âœ… <strong>-50% sur lâ€™abonnement annuel</strong> (exclusivitÃ© pionniers)</li>
        <li>âœ… <strong>Canal privÃ©</strong> avec les fondateurs et les premiers utilisateurs</li>
        <li>âœ… <strong>Ton nom dans lâ€™histoire</strong> des premiers Ã  dÃ©mocratiser lâ€™aÃ©ro</li>
      </ul>
    </div>

    <!-- SECTION 3 : RÃ©assurance -->
    <div class="mt-16 text-left">
      <h2 class="text-2xl font-semibold mb-4">ğŸ”’ SÃ©curitÃ© et confiance</h2>
      <ul class="space-y-3 text-muted">
        <li>ğŸ’³ Paiement sÃ©curisÃ© par <strong>Stripe</strong></li>
        <li>ğŸŒ Compatible avec la majoritÃ© des home trainers connectÃ©s (Wahoo, Tacx, Eliteâ€¦)</li>
        <li>ğŸ“ˆ DÃ©veloppÃ© par un <strong>chercheur CNRS</strong> et triathlÃ¨te</li>
      </ul>
    </div>

    <!-- SECTION 4 : Appel final -->
    <div class="mt-20 flex flex-col items-center">
      <h2 class="text-2xl font-bold mb-6">
        ğŸš€ PrÃªt Ã  gagner ta vitesse gratuite ?
      </h2>
      <button
        id="btn-checkout-final"
        type="button"
        class="btn btn-primary px-10 py-3"
        aria-label="AccÃ©der Ã  l'offre pionnier AeroX et payer en ligne"
      >
        Oui, je deviens pionnier AeroX
      </button>
      <small class="block mt-3 text-xs text-muted">
        Offre limitÃ©e aux <strong>100 premiers pionniers</strong> â€” Avantages Ã  vie
      </small>
    </div>

    <!-- FOOTER NOTE -->
    <p class="text-xs text-muted mt-12">
      AeroX transforme ton home trainer en soufflerie : mesure ta position, Ã©conomise 40 W et gagne 2â€“3 km/h gratuitement.  
      Une alternative innovante et complÃ©mentaire Ã  Zwift, MyWhoosh et Kinomap.
    </p>
  </section>

  <script is:inline>
    const callCheckout = async (payload = {}) => {
      const res = await fetch('/api/create-api-checkout', {
        method: 'POST',
        headers: { 'content-type': 'application/json' },
        body: JSON.stringify(payload),
      });
      const data = await res.json();
      if (data?.url) {
        window.location.href = data.url;
      } else {
        throw new Error(data?.error || 'Erreur Stripe');
      }
    };

    const withLoading = async (btn, fn) => {
      if (!btn) return;
      btn.disabled = true;
      const prev = btn.innerHTML;
      btn.innerHTML = 'Redirectionâ€¦';
      try {
        await fn();
      } catch (e) {
        alert(e?.message || e || 'Erreur');
        btn.disabled = false;
        btn.innerHTML = prev;
      }
    };

    document.getElementById('btn-checkout')?.addEventListener('click', (e) => {
      withLoading(e.currentTarget, () => callCheckout());
    });
    document.getElementById('btn-checkout-final')?.addEventListener('click', (e) => {
      withLoading(e.currentTarget, () => callCheckout());
    });
  </script>
</Layout>
