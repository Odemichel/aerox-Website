---
import Layout from '~/layouts/Layout.astro';
import { getDict, t } from '~/lib/i18n';

import livreCover from '~/assets/images/livre/image_livre_entrainer-aero.png'; // ‚ö†Ô∏è adapte le nom exact

const { lang } = Astro.params;
const dict = getDict(lang);

const metadata = {
  title: t(dict, 'success.meta.title'),
  description: t(dict, 'success.meta.description'),
};
---

<Layout metadata={metadata}>
  <section class="max-w mx-auto py-20 text-center">
    <h1 class="text-3xl font-bold mb-4">
      ‚úÖ {t(dict, 'success.title')}
    </h1>

    <p class="text-lg mb-8">
      {t(dict, 'success.livre.subtitle1')}<br />
    </p>
    <div class="max-w-6xl px-12 grid md:grid-cols-2 gap-12 items-center">
      <!-- Image du livre -->
      <div class="flex justify-center">
        <img
          src={livreCover.src}
          width={livreCover.width}
          height={livreCover.height}
          alt="Couverture du livre a√©rodynamique"
          class="w-[100%] md:w-[100%] max-w-md float-book mt -8"
          loading="eager"
        />
      </div>
      <div class="flex flex-col justify-center items-center gap-6">
        <a id="download-livre" style="display:none" class="btn btn-primary w-[90%] md:w-[80%] py-3" target="_blank">
          Lien de t√©l√©chargement
        </a>
        <p>Lien valable pendant 10 minutes</p>
      </div>
    </div>

    <!-- ‚úÖ Retour accueil -->
    <div class="flex justify-center mt-16">
      <a href={`/${lang}/`} class="btn px-6 py-3">
        {t(dict, 'success.backHome')}
      </a>
    </div>
  </section>

  <style>
    @keyframes floatBook {
      0% {
        transform: translateY(0px);
      }
      50% {
        transform: translateY(14px);
      }
      100% {
        transform: translateY(0px);
      }
    }

    .float-book {
      animation: floatBook 3s ease-in-out infinite;
      will-change: transform;
    }
  </style>
  <script is:inline>
    const params = new URLSearchParams(window.location.search);
    const sessionId = params.get('session_id');

    const downloadBtn = document.getElementById('download-livre');

    if (sessionId) {
      const downloadUrl = `/telechargement/api/generate-livre-download/?session_id=${sessionId}`;

      // üîπ Fallback bouton toujours pr√™t
      downloadBtn.href = downloadUrl;
      downloadBtn.style.display = 'inline-block';

      // üîπ Auto t√©l√©chargement
      window.location.href = downloadUrl;
    }
  </script>
</Layout>
