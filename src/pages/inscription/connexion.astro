---
import Button from '~/components/ui/Button.astro';
import Layout from '~/layouts/PageLayout.astro';

const metadata = {
  title: 'Connexion ‚Äî AeroX',
  description: "Connecte-toi √† ton compte AeroX pour acc√©der √† l'application et √† tes abonnements.",
};
---

<Layout metadata={metadata}>
  <section class="max-w-md mx-auto py-16 px-6 text-center">
    <h1 class="text-3xl font-bold mb-6">Connexion √† AeroX</h1>
    <p class="mb-8 text-black dark:text-white">
      Acc√®de √† ton espace AeroX üèÜ<br />
      Connecte-toi avec ton email et ton mot de passe.
    </p>

    <form id="login-form" class="flex flex-col gap-4 text-left">
      <label for="email" class="font-medium">Email</label>
      <input
        type="email"
        id="email"
        placeholder="ton@email.com"
        required
        class="border rounded p-3 text-secondary"
      />

      <label for="password" class="font-medium">Mot de passe</label>
      <input
        type="password"
        id="password"
        placeholder="********"
        required
        minlength="8"
        class="border rounded p-3 text-secondary"
      />

      <Button
        variant="primary"
        type="submit"
        text="Se connecter"
        class="mt-6 w-full justify-center"
      />
    </form>

    <!-- Mot de passe oubli√© -->
    <p class="mt-4 text-sm text-gray-600 dark:text-gray-300">
      Mot de passe oubli√© ?
      <a href="/reset-password" class="underline text-primary hover:text-primary/80">
        R√©initialiser
      </a>
    </p>

    <p id="message" class="mt-6 text-sm"></p>
  </section>

  <script>
    import { supabase } from '~/config/supabaseClient';

    const form = document.getElementById('login-form');
    const message = document.getElementById('message');

    function showMessage(text, isError = true) {
      if (!message) return;
      message.textContent = text;
      message.classList.remove('text-red-600', 'text-green-600');
      message.classList.add(isError ? 'text-red-600' : 'text-green-600');
    }

    if (form) {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const emailEl = document.getElementById('email') as HTMLInputElement | null;
        const passwordEl = document.getElementById('password') as HTMLInputElement | null;

        const email = emailEl?.value.trim() ?? '';
        const password = passwordEl?.value.trim() ?? '';

        if (!email || !password) {
          showMessage('‚ùå Merci de remplir tous les champs.');
          return;
        }
const { data, error } = await supabase.auth.signInWithPassword({
  email,
  password,
});

if (error) {
  showMessage('‚ùå ' + error.message);
} else {
  console.log("Utilisateur connect√© :", data.user);
  showMessage('‚úÖ Connexion r√©ussie !', false);
  window.location.href = '/inscription/dashboard';
}

      });
    }
  </script>
</Layout>
